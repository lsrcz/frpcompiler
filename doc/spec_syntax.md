# Syntax of the specification

## Related files

- [test/test-spec.rkt](../test/test-spec.rkt)
- [ast/syntax.rkt](../ast/syntax.rkt)

## Definition of the specification

```racket
(struct spec (inputs output funclist constantlist body) #:transparent)
```
members:

- `inputs`: A list of symbols, representing the name of the input streams.
- `output`: A symbol, representing the name of the output stream.
- `funclist`: A list of symbols, representing the abstract functions that can be used in the specification.
- `constantlist`: A list of symbols, representing the constant values that can be used in the specification.
- `body`: A list of transition functions. A transition function is a list, the first item is a symbol, representing the start point of the pipeline, and the second item is the body of the function.

## Syntax of the specification body

The specification body is generated by the following grammar:

```text
spec-body        => "(" trans-func-list ")"
trans-func-list  => trans-func | trans-func trans-func-list
trans-func       => "(" symbol inst ")"

inst             => "(" inst-no-brackets ")"
inst-no-brackets => if-inst | if-else-inst | begin-inst | return-inst | split-inst | custom-inst
if-inst          => "if" js-expr inst
if-else-inst     => "if-else" js-expr inst inst
return-inst      => "return" js-expr
custom-inst      => "custom" symbol inst

begin-inst       => "begin" let-inst-list inst | "begin" inst
let-inst         => "(" "let" symbol js-expr ")"
let-inst-list    => let-inst | let-inst let-inst-list

split-inst       => "split" "()" imp-inst | "split" "(" binding-list ")" imp-inst
binding-list     => binding | binding binding-list
binding          => "(" symbol js-expr ")"

imp-inst         => "(" imp-inst-no-brackets ")"
imp-inst-no-brackets => if-imp-inst | if-else-imp-inst | begin-imp-inst | new-stream-inst | empty-stream-inst
if-imp-inst      => "if" js-expr imp-inst
if-else-imp-inst => "if-else" js-expr imp-inst imp-inst

begin-imp-inst   => "begin" let-inst-list imp-inst | "begin" imp-inst

empty-stream-inst => "empty-stream"
new-stream-inst  => new-stream spec-body


```

where `js-expr` is an expression in javascript which can reference to the functions/bindings/input streams, and it's written in S-expression, and a `symbol` is any symbol.

